CREATE EXTENSION postgis;
CREATE EXTENSION schema_triggers;
CREATE EXTENSION plpythonu;
CREATE EXTENSION cartodb;
CREATE EXTENSION cdb_geocoder_admin1;
-- Check that the geocoding functions are callable, should return NULL
SELECT (geocode_admin1_polygons(Array['TX','Cuidad Real', 'sevilla'])).*;
      q      | geom | success 
-------------+------+---------
 TX          |      | f
 Cuidad Real |      | f
 sevilla     |      | f
(3 rows)
SELECT (geocode_admin1_polygons(Array['NH', 'Vermont'], 'United States')).*;
    q    | geom | success 
---------+------+---------
 NH      |      | f
 Vermont |      | f
(2 rows)
SELECT (geocode_admin1_polygons(Array['az', 'az'], Array['Ecuador', 'USA'])).*;
 q  |    c    | geom | success 
----+---------+------+---------
 az | Ecuador |      | f
 az | USA     |      | f
(2 rows)

-- Mock the varnish invalidation function
CREATE OR REPLACE FUNCTION public.cdb_invalidate_varnish(table_name text) RETURNS void AS $$
BEGIN
  RETURN;
END
$$
LANGUAGE plpgsql;

-- Add a few data to the sources
COPY global_province_polygons (the_geom,adm1_code, objectid_1, diss_me, adm1_cod_1, iso_3166_2, wikipedia, iso_a2, adm0_sr, name, name_alt, name_local, type, type_en, code_local, code_hasc, note, hasc_maybe, region, region_cod, provnum_ne, gadm_level, check_me, scalerank, datarank, abbrev, postal, area_sqkm, sameascity, labelrank, featurecla, name_len, mapcolor9, mapcolor13, fips, fips_alt, woe_id, woe_label, woe_name, latitude, longitude, sov_a3, iso3, adm0_label, admin, geonunit, gu_a3, gn_id, gn_name, gns_id, gns_name, gn_level, gn_region, gn_a1_code, region_sub, sub_code, gns_level, gns_lang, gns_adm1, gns_region, cartodb_id, created_at, updated_at, synonyms, frequency) FROM stdin;
0106000020E6100000010000000103000000010000000400000000000000005009C07FB86AC523AF4340FFFFFFFFFFEF0EC0C3CF8DC4FADB42400000000000E0F0BFC3CF8DC4FADB424000000000005009C07FB86AC523AF4340	SVN-1035	1473	1035	SVN-1035	SI-	\N	SI	1	Vipava	\N	\N	Opcine	Commune|Municipality	\N	SI.SP.VI	\N	\N	Gori≈°ka	\N	162	2	0	10	8	\N	VI	0	-99	10	Admin-1 scale rank	6	2	12	SIE1	\N	-55848385	\N	\N	45.8271000000000015	13.9723000000000006	SVN	SVN	2	Slovenia	Slovenia	SVN	323075	Obcina Vipava	243467	Vipava, Obcina	1	\N	SI.E1	\N	\N	1	div	SI05	\N	3700	2014-02-18 19:53:50.080158+00	2014-04-01 15:18:54.094644+00	{vipava,"obcina vipava","vipava,obcina",si.e1,si.sp.vi,svn-1035,svn-1035}	5
\.

-- Check that the synonym function is callable, should return true
SELECT (geocode_admin1_polygons(Array['obcina vipava'])).success;
 success 
---------
 t
(1 row)